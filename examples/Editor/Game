#pragma once

#include <QtEntity/EntityManager>
#include <QObject>
#include <QTimer>
#include <QKeyEvent>


class BulletSystem;
class DamageSystem;
class EnemySystem;
class MetaDataSystem;
class Renderer;
class ShapeSystem;


class Game : public QObject
{

    Q_OBJECT

public:

    Game(Renderer*);

    QtEntity::EntityManager& entityManager() { return _entityManager; }

    void keyPressEvent ( QKeyEvent * event );
    void keyReleaseEvent ( QKeyEvent * event );

    enum KeyBit
    {
        UP_PRESSED    = 1 << 0,
        DOWN_PRESSED  = 1 << 1,
        LEFT_PRESSED  = 1 << 2,
        RIGHT_PRESSED = 1 << 3,
        SPACE_PRESSED = 1 << 4
    };

public slots:

    void init();
    void run();
    void end();
    void step(int frameNumber, int totalTime, int delta);

private:

    void createEnemy();
    void createPlayer();

    unsigned int _keyBits;

    Renderer* _renderer;
    QtEntity::EntityManager _entityManager;
    bool _isRunning;

    BulletSystem* _bulletsys;
    DamageSystem* _damagesys;
    MetaDataSystem* _metasys;
    EnemySystem* _enemysys;
    ShapeSystem* _shapesys;

    QtEntity::EntityId _playerid;
};



