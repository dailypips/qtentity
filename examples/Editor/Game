#pragma once

#include <QtEntity/EntityManager>
#include <QObject>
#include <QTimer>
#include <QKeyEvent>

class Renderer;

class Renderer;
class BulletSystem;
class EnemySystem;
class ShapeSystem;
class DamageSystem;

namespace QtEntity
{
    class MetaDataSystem;
}

class Game : public QObject
{
    Q_OBJECT

public:

    Game(Renderer*);

    QtEntity::EntityManager& entityManager() { return _entityManager; }

    void keyPressEvent ( QKeyEvent * event );
    void keyReleaseEvent ( QKeyEvent * event );

public slots:

    void run();
    void end();
    void step(int frameNumber, int totalTime, int delta);

private:

    void createEnemy();
    void createPlayer();

    bool _leftpressed;
    bool _rightpressed;
    bool _spacepressed;


    Renderer* _renderer;
    QtEntity::EntityManager _entityManager;
    bool _isRunning;

    BulletSystem* _bulletsys;
    DamageSystem* _damagesys;
    QtEntity::MetaDataSystem* _metasys;
    EnemySystem* _enemysys;
    ShapeSystem* _shapesys;

    QtEntity::EntityId _playerid;

};

