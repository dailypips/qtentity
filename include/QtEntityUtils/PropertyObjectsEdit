#pragma once

#include <QPushButton>
#include <QVariantList>
#include <QDialog>
#include <QtEntity/DataTypes>

class Ui_PropertyObjectsEdit;
class QtTreePropertyBrowser;
class QtVariantPropertyManager;
class QtProperty;
class QtBrowserItem;

namespace QtEntityUtils
{

    class PropertyObjectEditor : public QDialog
    {
        Q_OBJECT
    public:
        PropertyObjectEditor(QVariantList& objects, const QStringList& classnames);

        QVariantList propertyObjects() const;

        static QVariantMap componentToVariantMap(const QObject& object);
        static QObject* variantMapToObject(const QVariantMap& map);
        static QtEntity::PropertyObjects updatePropertyObjectsFromVariantList(const QtEntity::PropertyObjects& in, const QVariantList& varlist);

    protected slots:

        void addObject();
        void currentItemChanged(QtBrowserItem *);
        void upPressed();
        void downPressed();
        void removePressed();

    private:
        void addObjectProperties(const QString& classname, const QVariantMap& obj);

        QStringList _classNames;
        Ui_PropertyObjectsEdit* _ui;
        QtVariantPropertyManager* _propertyManager;
        QtTreePropertyBrowser* _editor;
        QtBrowserItem* _selectedItem;
    };


    class PropertyObjectsEdit : public QWidget
    {
        Q_OBJECT
    public:
        PropertyObjectsEdit(QWidget *parent = 0);
        void setValue(const QVariantList& o) { _value = o; }
        void setClassNames(const QStringList& l) { _classnames = l; }
    signals:
        void objectsChanged(const QVariantList& objs);

    private slots:
        void openEditor();
        void editorClosed(int result);
    private:
        PropertyObjectEditor* _editor;
        QPushButton* _editButton;
        QVariantList _value;
        QStringList _classnames;
    };
}
