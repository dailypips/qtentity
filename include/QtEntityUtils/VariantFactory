#pragma once

#include <QtEntityUtils/Export>
#include <QtPropertyBrowser/QtVariantProperty>
#include <QtEntity/DataTypes>

namespace QtEntityUtils
{
    class FileEdit;
    class PropertyObjectsEdit;

    class VariantFactory : public QtVariantEditorFactory
    {
        Q_OBJECT
    public:
        VariantFactory(QObject *parent = 0)
            : QtVariantEditorFactory(parent)
        {
        }

        virtual ~VariantFactory();
    protected:
        virtual void connectPropertyManager(QtVariantPropertyManager *manager);
        virtual QWidget *createEditor(QtVariantPropertyManager *manager, QtProperty *property,
                    QWidget *parent);
        virtual void disconnectPropertyManager(QtVariantPropertyManager *manager);
    private slots:
        void slotPropertyChanged(QtProperty *property, const QVariant &value);
        void slotPropertyAttributeChanged(QtProperty *property, const QString &attribute, const QVariant &value);
        void slotSetValue(const QString &value);
        void slotSetObjectsValue(const QVariantList &value);
        void slotEditorDestroyed(QObject *object);
    private:
        QMap<QtProperty *, QList<FileEdit *> > _createdFileEditors;
        QMap<FileEdit *, QtProperty *> _fileEditorToProperty;
        QMap<QtProperty *, QList<PropertyObjectsEdit *> > _createdPropertyObjectsEditors;
        QMap<PropertyObjectsEdit *, QtProperty *> _propertyObjectsEditorToProperty;
    };
}
